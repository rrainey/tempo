#
# Copyright (c) 2018 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

# Logger module
CONFIG_LOG=y



CONFIG_MAIN_STACK_SIZE=4096

# Button and LED library
CONFIG_DK_LIBRARY=y

# Floating Point Unit
CONFIG_FPU=y

# Bluetooth LE
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Tempo-BT"
CONFIG_BT_LBS=y
CONFIG_BT_LBS_POLL_BUTTON=y
CONFIG_BT_GATT_CLIENT=y

# STEP 5 - Configure your preferred connection parameters
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=800
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=800
CONFIG_BT_PERIPHERAL_PREF_LATENCY=0
CONFIG_BT_PERIPHERAL_PREF_TIMEOUT=400
CONFIG_BT_GAP_AUTO_UPDATE_CONN_PARAMS=y

# STEP 8.2 - Enable PHY updates.
CONFIG_BT_USER_PHY_UPDATE=y

# STEP 12 - Update Data Length and MTU
CONFIG_BT_USER_DATA_LEN_UPDATE=y
###CONFIG_BT_CTLR_DATA_LENGTH_MAX=251
#CONFIG_BT_BUF_ACL_RX_SIZE=251
#CONFIG_BT_BUF_ACL_TX_SIZE=251
#CONFIG_BT_L2CAP_TX_MTU=247

# Increase stack size for the main thread, System Workqueue, and BT RX thread
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
CONFIG_BT_RX_STACK_SIZE=2048

# Tempo extra settings
CONFIG_POSIX_API=y

CONFIG_LOG_BACKEND_RTT=y
CONFIG_LOG_BACKEND_UART=n
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_CBPRINTF_FP_SUPPORT=y
CONFIG_USE_SEGGER_RTT=y
CONFIG_RTT_CONSOLE=y

# Flash and QSPI configuration
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_NORDIC_QSPI_NOR_STACK_WRITE_BUFFER_SIZE=16

# Enable PM for QSPI power management
CONFIG_PM_DEVICE=y

# File system configuration
CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_LITTLEFS=y
CONFIG_FS_LITTLEFS_NUM_FILES=4
CONFIG_FS_LITTLEFS_NUM_DIRS=4

# Flash map configuration
CONFIG_FLASH_MAP=y

# Stack sizes - increased for LittleFS and logging
CONFIG_MAIN_STACK_SIZE=8192
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096

# Heap for dynamic allocation
CONFIG_HEAP_MEM_POOL_SIZE=8192

# Settings configuration
CONFIG_SETTINGS=y
CONFIG_SETTINGS_NVS=y
CONFIG_NVS=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# Thread configuration
CONFIG_INIT_STACKS=y
CONFIG_THREAD_STACK_INFO=y
CONFIG_THREAD_MONITOR=y

# UART configuration
CONFIG_SERIAL=y
CONFIG_UART_ASYNC_API=y
# had to change this
CONFIG_UART_INTERRUPT_DRIVEN=y

CONFIG_GPIO=y
CONFIG_I2C=y
CONFIG_SPI=y
CONFIG_SPI_NRFX=y

# Increase ISR stack for UART async callbacks
CONFIG_ISR_STACK_SIZE=2048

# SD Card support
CONFIG_DISK_ACCESS=y
CONFIG_DISK_DRIVER_SDMMC=y
CONFIG_SDHC=y
CONFIG_SDMMC_STACK=y
#CONFIG_SDMMC_VOLUME_NAME="SD"

# Enable the SPI driver for the SD card
#CONFIG_SDHC_SPI_DRIVER=y

# FAT filesystem support
CONFIG_FAT_FILESYSTEM_ELM=y
CONFIG_FS_FATFS_EXFAT=y  
CONFIG_FS_FATFS_LFN=y   
CONFIG_FS_FATFS_LFN_MODE_HEAP=y
CONFIG_FS_FATFS_MAX_LFN=255
CONFIG_FS_FATFS_CODEPAGE=437  
CONFIG_FS_FATFS_NUM_FILES=8
CONFIG_FS_FATFS_NUM_DIRS=8 

# Increase stack sizes for FAT operations
#CONFIG_SDMMC_STACK_SIZE=2048
CONFIG_FS_FATFS_REENTRANT=y

# BLE configuration
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Tempo-BT"
#CONFIG_BT_RX_STACK_SIZE=2048
#CONFIG_BT_HCI_TX_STACK_SIZE=2048



# Increase BLE buffers for better throughput
CONFIG_BT_L2CAP_TX_BUF_COUNT=8
#CONFIG_BT_BUF_ACL_RX_SIZE=256
#CONFIG_BT_BUF_ACL_TX_SIZE=256
CONFIG_BT_ATT_PREPARE_COUNT=2

CONFIG_ZCBOR=y

# mcumgr and SMP configuration
CONFIG_MCUMGR=y
CONFIG_MCUMGR_GRP_FS=y
CONFIG_MCUMGR_GRP_IMG=y
CONFIG_MCUMGR_GRP_OS=y
CONFIG_MCUMGR_GRP_STAT=y
#CONFIG_MCUMGR_MGMT_CUSTOM_PAYLOAD_SIZE=256 

# SMP over Bluetooth
CONFIG_MCUMGR_TRANSPORT_BT=y
#CONFIG_MCUMGR_TRANSPORT_BT_AUTHEN=n
CONFIG_MCUMGR_TRANSPORT_BT_PERM_RW=y
CONFIG_MCUMGR_TRANSPORT_BT_CONN_PARAM_CONTROL=y

# File system management
#CONFIG_MCUMGR_GRP_FS_MAX_FILE_SIZE=0   
CONFIG_MCUMGR_GRP_FS_DL_CHUNK_SIZE=256
CONFIG_MCUMGR_GRP_FS_DL_CHUNK_SIZE_LIMIT=y

# Image management for DFU
CONFIG_STREAM_FLASH=y
CONFIG_IMG_MANAGER=y
CONFIG_MCUBOOT_IMG_MANAGER=y
CONFIG_IMG_BLOCK_BUF_SIZE=512

# Shell over mcumgr (optional but useful)
CONFIG_SHELL=y
CONFIG_SHELL_BACKENDS=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_CMD_BUFF_SIZE=256

# Required for the callback system
CONFIG_MCUMGR_MGMT_NOTIFICATION_HOOKS=y
CONFIG_MCUMGR_GRP_FS_FILE_ACCESS_HOOK=y

# OS management group
CONFIG_MCUMGR_GRP_OS_TASKSTAT=y
CONFIG_MCUMGR_GRP_OS_ECHO=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_MONITOR=y

# Statistics
CONFIG_STATS=y
CONFIG_STATS_NAMES=y
CONFIG_MCUMGR_GRP_STAT_MAX_NAME_LEN=32

# MCUboot support
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_MCUBOOT_SIGNATURE_KEY_FILE="bootloader/mcuboot/root-rsa-2048.pem"

CONFIG_NCS_SAMPLE_MCUMGR_BT_OTA_DFU=y

# Flash layout for MCUboot
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y

# Enable reboot command
CONFIG_REBOOT=y

# mcumgr_bt_ota_dfu/CMakeLists.txt:27 suggests:
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_BUF_ACL_RX_SIZE=502
CONFIG_BT_L2CAP_TX_MTU=498